<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>NUMINA | Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
    :root {
      --primary: #ffd700;
      --primary-dark: #e6c200;
      --dark: #111;
      --dark-light: #1a1a1a;
      --dark-lighter: #222;
      --text: #fff;
      --text-light: #ccc;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--dark);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .dashboard-header {
      background: linear-gradient(to right, var(--dark), var(--dark-lighter));
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 215, 0, 0.1);
    }

    .logo {
      color: var(--primary);
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary);
      color: var(--dark);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      cursor: pointer;
    }

    .dashboard-container {
      display: flex;
      flex: 1;
    }

    .sidebar {
      width: 250px;
      background-color: var(--dark-light);
      padding: 1.5rem 0;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
    }

    .sidebar-menu {
      list-style: none;
    }

    .menu-item {
      padding: 0.8rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menu-item:hover, .menu-item.active {
      background-color: rgba(255, 215, 0, 0.1);
      border-left: 3px solid var(--primary);
      color: var(--primary);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
    }

    .main-content {
      flex: 1;
      padding: 2rem;
      background-color: var(--dark);
    }

    .welcome-banner {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
      border: 1px solid rgba(255, 215, 0, 0.1);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .welcome-text h2 {
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .welcome-text p {
      color: var(--text-light);
    }

    .referral-code {
      background-color: var(--dark-light);
      padding: 0.8rem 1.2rem;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .referral-code span {
      font-weight: 600;
      letter-spacing: 1px;
    }

    .copy-btn {
      background-color: var(--primary);
      color: var(--dark);
      border: none;
      padding: 0.3rem 0.6rem;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .copy-btn:hover {
      background-color: var(--primary-dark);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background-color: var(--dark-light);
      border-radius: 10px;
      padding: 1.5rem;
      border-left: 4px solid var(--primary);
    }

    .stat-card h3 {
      color: var(--text-light);
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-card .value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .stat-card .change {
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .change.positive {
      color: var(--success);
    }

    .change.negative {
      color: var(--danger);
    }

    .section-title {
      color: var(--primary);
      margin: 2rem 0 1rem;
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .table-container {
      background-color: var(--dark-light);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 1rem;
      text-align: left;
    }

    th {
      background-color: var(--dark-lighter);
      color: var(--primary);
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 1px;
    }

    td {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      color: var(--text-light);
    }

    tr:last-child td {
      border-bottom: none;
    }

    .status {
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status.active {
      background-color: rgba(40, 167, 69, 0.2);
      color: var(--success);
    }

    .status.pending {
      background-color: rgba(255, 193, 7, 0.2);
      color: var(--warning);
    }

    .status.completed {
      background-color: rgba(13, 110, 253, 0.2);
      color: #0d6efd;
    }

    .action-btn {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      padding: 0.3rem 0.8rem;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .action-btn:hover {
      background-color: var(--primary);
      color: var(--dark);
    }

    .account-info {
      background-color: var(--dark-light);
      border-radius: 10px;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .info-item h4 {
      color: var(--text-light);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .info-item p {
      font-weight: 600;
    }

    .edit-btn {
      display: inline-block;
      margin-top: 1.5rem;
      background-color: var(--primary);
      color: var(--dark);
      padding: 0.6rem 1.2rem;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
    }

    .edit-btn:hover {
      background-color: var(--primary-dark);
    }

    .error-banner {
      background: rgba(220, 53, 69, 0.2);
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 1rem;
      border: 1px solid var(--danger);
    }

    .error-banner i {
      color: var(--danger);
    }

    .error-banner button {
      margin-left: auto;
      background: var(--dark);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }

    @media (max-width: 992px) {
      .sidebar {
        width: 70px;
      }

      .menu-item span {
        display: none;
      }

      .menu-item {
        justify-content: center;
      }

      .welcome-banner {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }
    }

    @media (max-width: 768px) {
      .dashboard-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        padding: 0;
      }

      .sidebar-menu {
        display: flex;
        overflow-x: auto;
      }

      .menu-item {
        padding: 1rem;
        min-width: 70px;
      }
    }

    /* added: ensure section-content hidden by default */
    .section-content { display: none; }

    /* ===== Estilos de Configuraci√≥n (no afectan al dashboard) ===== */
    .settings-card { background-color: var(--dark-light); border: 1px solid rgba(255,255,255,.05); border-radius:10px; padding:1.5rem; margin-bottom:1.5rem; }
    .settings-card h3 { color: var(--primary); margin-bottom:.8rem; font-size:1.05rem; }
    .form-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:1rem; }
    .form-row { display:flex; flex-direction:column; gap:.4rem; }
    .form-row label { color:var(--text-light); font-size:.9rem; }
    .form-row input, .form-row select { background:var(--dark); border:1px solid var(--dark-lighter); border-radius:8px; padding:.7rem .8rem; color:var(--text); outline:none; }
    .form-actions { display:flex; gap:.6rem; justify-content:flex-end; margin-top:1rem; }
    .btn { background:var(--primary); color:var(--dark); border:none; padding:.6rem 1rem; border-radius:8px; font-weight:600; cursor:pointer; }
    .btn:hover { background:var(--primary-dark); }
    .helper { color:var(--text-light); font-size:.85rem; margin-top:.4rem; }
  </style>
<style>
  /* === Productos (scoped) === */
  .section-title { color: var(--primary, #ffd700); margin: 0 0 1rem; font-size: 1.3rem; font-weight: 600; display: flex; align-items: center; gap: .8rem; }
  .products-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.2rem; }
  @media (max-width: 1200px) { .products-grid { grid-template-columns: repeat(3, 1fr); } }
  @media (max-width: 900px)  { .products-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 560px)  { .products-grid { grid-template-columns: 1fr; } }
  .product-card { background: var(--dark-light, #1a1a1a); border: 1px solid rgba(255,255,255,.05); border-radius: 14px; overflow: hidden; display: flex; flex-direction: column; transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease; }
  .product-card:hover { transform: translateY(-2px); border-color: rgba(255,215,0,.25); box-shadow: 0 8px 24px rgba(0,0,0,.35); }
  .product-media { background: var(--dark-lighter, #222); aspect-ratio: 16/10; }
  .product-media img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .product-body { padding: 1rem; display: flex; flex-direction: column; gap: .6rem; }
  .product-title { font-size: 1rem; font-weight: 700; color: var(--text, #fff); }
  .product-desc  { font-size: .9rem; color: var(--text-light, #ccc); }
  .price { color: var(--primary, #ffd700); font-weight: 700; font-size: 1.1rem; }
  .btn { background: transparent; color: var(--primary, #ffd700); border: 1px solid var(--primary, #ffd700); padding: .55rem .9rem; border-radius: 8px; font-weight: 700; cursor: pointer; transition: background .2s ease, color .2s ease; }
  .btn:hover { background: var(--primary, #ffd700); color: var(--dark, #111); }
  .btn-primary { background: var(--primary, #ffd700); color: var(--dark, #111); }
  .btn-primary:hover { filter: brightness(0.95); }

</style>

<style>
  /* === NUMINA Productos override: fixed 2x2 centered grid === */
  #section-productos .products-wrap { max-width: 1100px; margin: 0 auto; padding: 0 1rem; }
  #section-productos .products-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    justify-items: center;
  }
  @media (max-width: 900px) { 
    #section-productos .products-grid { grid-template-columns: 1fr; }
  }
  #section-productos .product-card { width: 100%; max-width: 500px; border-radius: 16px; }
  #section-productos .section-title { justify-content: center; }
  #section-productos .product-media { aspect-ratio: 16/9; display:block; }
</style>



<style>
  /* Compact top spacing for products */
  #section-productos { margin-top: 0; }
  #section-productos .products-wrap { padding-top: 0.5rem; }
</style>


<style>
  /* === NUMINA: Modal de producto pantalla completa === */
  .nm-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;z-index:1000;}
  .nm-overlay.show{display:block;}
  .nm-modal{position:relative;min-height:100vh;background:#111214;color:#fff;display:flex;flex-direction:column;}
  .nm-modal header{display:flex;justify-content:space-between;align-items:center;padding:16px 18px;background:#1a1b1f;border-bottom:1px solid #24262b}
  .nm-modal header h3{margin:0;font-size:18px;color:#ffd700;letter-spacing:.3px}
  .nm-close{background:transparent;border:0;color:#b7b7b7;font-size:22px;cursor:pointer}
  .nm-body{flex:1;display:grid;grid-template-columns:0.85fr 1.15fr;gap:22px;padding:22px;max-width:1200px;margin:0 auto}
  .nm-imgbox{background:#222;border-radius:16px;display:flex;align-items:center;justify-content:center;overflow:hidden;aspect-ratio:1/1;max-width:520px;width:100%;margin:0 auto}
  .nm-imgbox img{width:100%;height:100%;display:block;object-fit:contain}
  .nm-info h4{margin:.2rem 0 .6rem;font-size:22px}
  .nm-desc{color:#d0d0d0;line-height:1.55;margin:0 0 14px}
  .nm-price{font-size:24px;font-weight:900;margin:10px 0 18px;color:#ffd700}
  .nm-actions{display:flex;gap:10px;align-items:center;margin-top:6px}
  .nm-btn{background:transparent;border:1px solid #3a3a3a;color:#fafafa;padding:11px 14px;border-radius:12px;cursor:pointer}
  .nm-buy{background:#ffd700;color:#111;border:0;padding:12px 18px;border-radius:12px;font-weight:900;cursor:pointer}
  .nm-note{font-size:12px;color:#9aa0a6;margin-top:8px}
  @media(max-width:900px){.nm-body{flex:1;display:grid;grid-template-columns:0.85fr 1.15fr;gap:22px;padding:22px;max-width:1200px;margin:0 auto}

  .nm-pitch{margin:10px 0 14px;padding:12px 14px;border:1px solid #2b2e34;background:#16181d;border-radius:12px;line-height:1.55;color:#e7e7e7}
  .nm-pitch strong{color:#ffd700}
}
</style>

</head>
<body>
<header class="dashboard-header"><div style="flex-grow:1; text-align:center;"><div class="logo">NUMINA</div></div><div class="user-menu">
<div class="user-avatar" id="user-avatar">US</div>
</div>
</header>
<div class="dashboard-container">
<nav class="sidebar">
<ul class="sidebar-menu">
<li class="menu-item active" data-target="dashboard">
<i class="fas fa-home"></i>
<span>Dashboard</span>
</li>
<li class="menu-item" data-target="compras">
<i class="fas fa-shopping-bag"></i>
<span>Mis Compras</span>
</li>
<li class="menu-item" data-target="sorteos">
<i class="fas fa-ticket-alt"></i>
<span>Sorteos</span>
</li>
<li class="menu-item" data-target="referidos">
<i class="fas fa-users"></i>
<span>Referidos</span>
</li>
<li class="menu-item" data-target="productos">
<i class="fas fa-box"></i>
<span>Productos</span>
</li>
<li class="menu-item" data-target="configuracion">
<i class="fas fa-cog"></i>
<span>Configuraci√≥n</span>
</li>
<li class="menu-item" data-target="logout" id="logout-btn">
<i class="fas fa-sign-out-alt"></i>
<span>Cerrar Sesi√≥n</span>
</li>
</ul>
</nav>
<main class="main-content"><div id="main-dashboard">
<section class="welcome-banner" id="welcome-banner">
<div class="welcome-text">
<h2 id="welcome-title">Cargando datos...</h2>
<p id="welcome-subtitle" style="display: none;">Por favor espera</p>
</div>
<div class="referral-code">
<i class="fas fa-user-plus"></i>
<span id="referral-code">---</span>
<button class="copy-btn" id="copy-btn">Copiar</button>
</div>
</section>
<div class="stats-grid">
<div class="stat-card">
<h3>Saldo Disponible</h3>
<div class="value" id="balance-value">$---</div>
<div class="change positive">
<i class="fas fa-arrow-up"></i>
<span>Cargando...</span>
</div>
</div>
<div class="stat-card">
<h3>Compras Activas</h3>
<div class="value" id="purchases-value">--</div>
<div class="change positive">
<i class="fas fa-arrow-up"></i>
<span>Cargando...</span>
</div>
</div>
<div class="stat-card">
<h3>Referidos</h3>
<div class="value" id="referrals-value">--</div>
<div class="change positive">
<i class="fas fa-arrow-up"></i>
<span>Cargando...</span>
</div>
</div>
<div class="stat-card">
<h3>Tickets de Sorteo</h3>
<div class="value" id="tickets-value">--</div>
<div class="change negative">
<i class="fas fa-arrow-down"></i>
<span>Cargando...</span>
</div>
</div>
</div>
<h2 class="section-title">
<i class="fas fa-shopping-bag"></i>
<span>Compras Activas</span>
</h2>
<div class="table-container">
<table id="purchases-table">
<thead>
<tr>
<th>Producto</th>
<th>Fecha</th>
<th>Valor</th>
<th>Estado</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="purchases-body">
<tr>
<td colspan="5" style="text-align: center;">Cargando compras...</td>
</tr>
</tbody>
</table>
</div>
<h2 class="section-title">
<i class="fas fa-users"></i>
<span>Historial de Referidos</span>
</h2>
<div class="table-container">
<table id="referrals-table">
<thead>
<tr>
<th>Referido</th>
<th>Fecha</th>
<th>Compras</th>
<th>Estado</th>
<th>Comisi√≥n</th>
</tr>
</thead>
<tbody id="referrals-body">
<tr>
<td colspan="5" style="text-align: center;">Cargando referidos...</td>
</tr>
</tbody>
</table>
</div>
<h2 class="section-title">
<i class="fas fa-user-circle"></i>
<span>Informaci√≥n de la Cuenta</span>
</h2>
<div class="account-info">
<div class="info-grid" id="account-info-grid">
<div class="info-item">
<h4>Nombre Completo</h4>
<p id="full-name">Cargando...</p>
</div>
<div class="info-item">
<h4>Correo Electr√≥nico</h4>
<p id="user-email">Cargando...</p>
</div>
<div class="info-item">
<h4>Tel√©fono</h4>
<p id="user-phone">Cargando...</p>
</div>
<div class="info-item">
<h4>Direcci√≥n</h4>
<p id="user-address">Cargando...</p>
</div>
</div>
<a class="edit-btn" href="#" id="edit-btn">Editar Informaci√≥n</a>
</div>
</div>

<!-- Configuraci√≥n: MOVIDA FUERA DE #main-dashboard -->
<section class="section-content" id="section-configuracion" style="display:none;">
  <h2 class="section-title"><i class="fas fa-cog"></i><span>Configuraci√≥n de la Cuenta</span></h2>

  <div class="settings-card">
    <h3><i class="fas fa-id-card"></i> Datos Personales</h3>
    <form id="config-datos-form">
      <div class="form-grid">
      <!-- Nota: El campo de correo electr√≥nico se elimin√≥ de este formulario porque se gestiona √∫nicamente desde el proveedor de autenticaci√≥n (Supabase Auth). Si en el futuro se habilita su edici√≥n, puede reinsertarse un campo de solo lectura o un enlace a la secci√≥n correspondiente. Esta nota existe solo como documentaci√≥n para el equipo y no se muestra al usuario. -->

        <div class="form-row"><label for="cfg-fullname">Nombre completo</label><input id="cfg-fullname" type="text" placeholder="Nombre y apellido"/></div>
        
        <div class="form-row"><label for="cfg-phone">Tel√©fono</label><input id="cfg-phone" type="tel" placeholder="+54 11 1234 5678"/></div>
        <div class="form-row"><label for="cfg-address">Direcci√≥n</label><input id="cfg-address" type="text" placeholder="Calle, n√∫mero, ciudad"/></div>
      </div>
      <div class="form-actions"><button class="btn" type="submit">Guardar cambios</button></div>
    </form>
  </div>

  <div class="settings-card">
    <h3><i class="fas fa-shield-alt"></i> Seguridad</h3>
    <form id="config-pass-form">
      <div class="form-grid">
        <div class="form-row"><label for="cfg-pass1">Nueva contrase√±a</label><input id="cfg-pass1" type="password" placeholder="********"/></div>
        <div class="form-row"><label for="cfg-pass2">Repetir contrase√±a</label><input id="cfg-pass2" type="password" placeholder="********"/></div>
      </div>
      <div class="form-actions"><button class="btn" type="submit">Actualizar contrase√±a</button></div>
    </form>
  </div>

  </section>

<section class="section-content" id="section-compras" style="display:none;">
  <h2 class="section-title">
    <i class="fas fa-shopping-bag"></i>
    <span>Mis Compras</span>
  </h2>
  <div class="table-container">
    <table id="miscompras-table">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Fecha</th>
          <th>Valor</th>
          <th>Estado</th>
          <th>Reclamo</th>
        </tr>
      </thead>
      <tbody id="miscompras-body">
        <tr>
          <td colspan="5" style="text-align: center;">Cargando compras...</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
<section class="section-content" id="section-productos" style="display:none;">
  <div class="products-wrap">
    <h2 class="section-title"><i class="fas fa-box"></i><span>Productos</span></h2>
    <section class="products-grid">
      <!-- Oro -->
      <article class="product-card">
        <figure class="product-media">
          <svg viewBox="0 0 640 360" width="100%" height="100%" preserveAspectRatio="xMidYMid slice" role="img" aria-label="Lingote de Oro">
            <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0%" stop-color="#4b4300"/><stop offset="100%" stop-color="#8a7a00"/></linearGradient></defs>
            <rect width="640" height="360" fill="url(#g1)"/><text x="50%" y="52%" text-anchor="middle" fill="#fff" font-family="Montserrat, sans-serif" font-weight="700" font-size="36">Lingote de Oro</text>
          </svg>
        </figure>
        <div class="product-body">
          <h3 class="product-title">Lingote 100g Oro Fino</h3>
          <p class="product-desc">Oro 999.9 certificado. Ideal para inversi√≥n y resguardo de valor.</p>
          <span class="price">US$ 13,500</span>
          <button class="btn btn-primary" data-action="more" data-sku="GOLD-100G">M√°s informaci√≥n</button>
        </div>
      </article>
      <!-- Platino -->
      <article class="product-card">
        <figure class="product-media">
          <svg viewBox="0 0 640 360" width="100%" height="100%" preserveAspectRatio="xMidYMid slice" role="img" aria-label="Lingote de Platino">
            <defs><linearGradient id="g2" x1="0" x2="1"><stop offset="0%" stop-color="#2e3136"/><stop offset="100%" stop-color="#6a6f78"/></linearGradient></defs>
            <rect width="640" height="360" fill="url(#g2)"/><text x="50%" y="52%" text-anchor="middle" fill="#fff" font-family="Montserrat, sans-serif" font-weight="700" font-size="36">Lingote de Platino</text>
          </svg>
        </figure>
        <div class="product-body">
          <h3 class="product-title">Lingote 100g Platino Fino</h3>
          <p class="product-desc">Platino 999.5 certificado. Inversi√≥n de alto valor y rareza.</p>
          <span class="price">US$ 6,500</span>
          <button class="btn btn-primary" data-action="more" data-sku="PLAT-100G">M√°s informaci√≥n</button>
        </div>
      </article>
      <!-- Rolex -->
      <article class="product-card">
        <figure class="product-media">
          <svg viewBox="0 0 640 360" width="100%" height="100%" preserveAspectRatio="xMidYMid slice" role="img" aria-label="Rolex 126610L">
            <defs><linearGradient id="g3" x1="0" x2="1"><stop offset="0%" stop-color="#0d1f14"/><stop offset="100%" stop-color="#1d6c3a"/></linearGradient></defs>
            <rect width="640" height="360" fill="url(#g3)"/><text x="50%" y="52%" text-anchor="middle" fill="#fff" font-family="Montserrat, sans-serif" font-weight="700" font-size="34">Rolex 126610L</text>
          </svg>
        </figure>
        <div class="product-body">
          <h3 class="product-title">Rolex Starbucks Ref. 126610L</h3>
          <p class="product-desc">Submariner Date con bisel verde y caja Oystersteel. Autom√°tico.</p>
          <span class="price">US$ 19,600</span>
          <button class="btn btn-primary" data-action="more" data-sku="ROLEX-126610L">M√°s informaci√≥n</button>
        </div>
      </article>
      <!-- Pulsera -->
      <article class="product-card">
        <figure class="product-media">
          <svg viewBox="0 0 640 360" width="100%" height="100%" preserveAspectRatio="xMidYMid slice" role="img" aria-label="Pulsera Numina">
            <defs><linearGradient id="g4" x1="0" x2="1"><stop offset="0%" stop-color="#2a0d2d"/><stop offset="100%" stop-color="#6f1d75"/></linearGradient></defs>
            <rect width="640" height="360" fill="url(#g4)"/><text x="50%" y="52%" text-anchor="middle" fill="#fff" font-family="Montserrat, sans-serif" font-weight="700" font-size="34">Pulsera Numina</text>
          </svg>
        </figure>
        <div class="product-body">
          <h3 class="product-title">Pulsera Numina</h3>
          <p class="product-desc">Dise√±o exclusivo con materiales de alta calidad. Edici√≥n limitada.</p>
          <span class="price">US$ 35</span>
          <button class="btn btn-primary" data-action="more" data-sku="NUMINA-BRACELET">M√°s informaci√≥n</button>
        </div>
      </article>
    </section>
</main></div>
<script src="https://unpkg.com/@supabase/supabase-js@2.39.0"></script>
<script>
// Memoized Supabase client: re-use the same instance so session persists between sections
(function(){
  const URL = 'https://xaeybhscsxpvtnqzpgwj.supabase.co';
  const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhZXliaHNjc3hwdnRucXpwZ3dqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MjQ0NzYsImV4cCI6MjA2OTUwMDQ3Nn0.o470dGkIyNKNP552A6DUB3pkJI3Lty9AZOdCmo3MQvU';
  let _client = window.__supabaseClient || null;
  window.getSupabase = function(){
    if (_client) { 
      window.__supabaseClient = _client; 
      return _client; 
    }
    // IMPORTANT: do NOT replace the next line; it must call window.supabase.createClient
    _client = window.supabase.createClient(URL, KEY, { 
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true, storage: localStorage }
    });
    window.__supabaseClient = _client; return _client;
  };
})();
</script>

<script>
  // 1. VERIFICACI√ìN DE CARGA DE SUPABASE
  function checkSupabaseLoaded() {
    return new Promise((resolve) => {
      const check = () => {
        if (window.supabase) {
          resolve();
        } else {
          setTimeout(check, 100);
        }
      };
      check();
    });
  }

  // 2. INICIALIZACI√ìN PRINCIPAL
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      // Espera a que Supabase est√© disponible
      await checkSupabaseLoaded();

      // Conexi√≥n a Supabase (TUS CREDENCIALES ORIGINALES)
      const supabase = getSupabase();

      // ‚ñ∫ [TODO EL RESTO DE TU C√ìDIGO ORIGINAL SE MANTIENE IGUAL]
      // Desde la verificaci√≥n de sesi√≥n hasta los event listeners
      const { data: { user }, error: authError } = await supabase.auth.getUser();
      if (authError || !user) {
        window.location.href = '/login.html';
        return;
      }

      const { data: userData, error: userError } = await supabase
        .from('users')
        .select('*, purchases(*), referrals(*)')
        .eq('id', user.id)
        .maybeSingle();

      if (userError) throw userError;

      // Actualizar UI (tu funci√≥n original)
      document.getElementById('user-avatar').textContent = 
        userData.full_name?.charAt(0).toUpperCase() || 'U';
      document.getElementById('welcome-title').textContent = 
        `Bienvenido, ${userData.full_name || userData.email}`;
      document.getElementById('referral-code').textContent = 
        userData.referral_code || '---';
      document.getElementById('balance-value').textContent = `$${userData.balance?.toFixed(2) || '0.00'}`;
      document.getElementById('purchases-value').textContent = userData.active_purchases || '0';
      document.getElementById('referrals-value').textContent = userData.referrals_count || '0';
      document.getElementById('tickets-value').textContent = userData.tickets_count || '0';
      document.getElementById('full-name').textContent = userData.full_name || 'No definido';
      document.getElementById('user-email').textContent = userData.email || 'No definido';
      document.getElementById('user-phone').textContent = userData.phone || 'No definido';
      document.getElementById('user-address').textContent = userData.address || 'No definido';

      // Compras
      const purchasesBody = document.getElementById('purchases-body');
      purchasesBody.innerHTML = userData.purchases?.length > 0 
        ? userData.purchases.map(p => `
            <tr>
              <td>${p.product_name}</td>
              <td>${new Date(p.created_at).toLocaleDateString()}</td>
              <td>$${(p.value ?? 0).toFixed(2)}</td>
              <td><span class="status ${p.status}">${p.status}</span></td>
              <td><button class="action-btn">Detalles</button></td>
            </tr>
          `).join('')
        : '<tr><td colspan="5" style="text-align: center;">No hay compras</td></tr>';

      // Referidos
      const referralsBody = document.getElementById('referrals-body');
      referralsBody.innerHTML = userData.referrals?.length > 0
        ? userData.referrals.map(r => `
            <tr>
              <td>${r.referred_email}</td>
              <td>${new Date(r.created_at).toLocaleDateString()}</td>
              <td>${r.purchases_count || '0'}</td>
              <td><span class="status ${r.is_active ? 'active' : 'inactive'}">${r.is_active ? 'Activo' : 'Inactivo'}</span></td>
              <td>$${(r.commission ?? 0).toFixed(2)}</td>
            </tr>
          `).join('')
        : '<tr><td colspan="5" style="text-align: center;">No hay referidos</td></tr>';

      // --- NUEVO: Prefill y handlers de Configuraci√≥n ---
      try { prefillConfigForms(userData); } catch(e) {}
      try { attachConfigHandlers(supabase); } catch(e) {}
      // ---------------------------------------------------

    } catch (error) {
      console.error('Error:', error);
      const banner = document.getElementById('welcome-banner');
      if (banner) {
        banner.innerHTML = `
          <div class="error-banner">
            <i class="fas fa-exclamation-circle"></i>
            <span>Error al conectar con el servidor. Recarga la p√°gina.</span>
            <button onclick="window.location.reload()">Reintentar</button>
          </div>
        `;
      }
    }
  });

  // Event listeners (originales)
  document.getElementById('copy-btn')?.addEventListener('click', function() {
    const code = document.getElementById('referral-code').textContent;
    navigator.clipboard.writeText(code);
    this.textContent = '¬°Copiado!';
    setTimeout(() => this.textContent = 'Copiar', 2000);
  });

  document.getElementById('logout-btn')?.addEventListener('click', async () => {
    const supabase = getSupabase();
    await getSupabase().auth.signOut();
    window.location.href = '/login.html';
  });
</script>
<script>
// NUEVOS helpers para Configuraci√≥n (no afectan otras vistas)
function prefillConfigForms(userData){
  const d = userData || {};
  const $ = (id)=>document.getElementById(id);
  if ($('cfg-fullname')) $('cfg-fullname').value = d.full_name || '';if ($('cfg-phone'))    $('cfg-phone').value    = d.phone || '';
  if ($('cfg-address'))  $('cfg-address').value  = d.address || '';
  if ($('cfg-lang'))     $('cfg-lang').value     = d.language || 'es';
}

function attachConfigHandlers(supabase){
  const datos = document.getElementById('config-datos-form');
  if (datos) datos.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const updates = {
      full_name: (document.getElementById('cfg-fullname').value||'').trim() || null,
      phone:     (document.getElementById('cfg-phone').value||'').trim() || null,
      address:   (document.getElementById('cfg-address').value||'').trim() || null,
    };
    // remove undefined keys and keep only provided values (avoid empty update bodies)
    Object.keys(updates).forEach(k => { if (updates[k] === undefined) delete updates[k]; });
    if (Object.values(updates).every(v => v === null)) { alert('No hay cambios para guardar'); return; }
    const { data: { user } } = await supabase.auth.getUser();
    const { data, error } = await supabase
      .from('users')
      .update(updates)
      .eq('id', user.id)
      .select('full_name,phone,address')
      .single();
    if (error) return alert('No se pudieron guardar los cambios');
    alert('Cambios guardados');
    const res = data || updates;
    // Refrescar en dashboard inmediatamente
    (function(){var el=document.getElementById('full-name'); if(el) el.textContent = (res.full_name ?? updates.full_name) || 'No definido';})();
    (function(){var el=document.getElementById('user-phone'); if(el) el.textContent = (res.phone ?? updates.phone) || 'No definido';})();
    (function(){var el=document.getElementById('user-address'); if(el) el.textContent = (res.address ?? updates.address) || 'No definido';})();
    // Y forzar re-fetch al volver al Dashboard por si hay c√°lculos derivados
    if (typeof cargarDashboard === 'function') { try { await cargarDashboard(); } catch(_){} }
  });

  const pass = document.getElementById('config-pass-form');
  if (pass) pass.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const p1 = document.getElementById('cfg-pass1').value;
    const p2 = document.getElementById('cfg-pass2').value;
    if (!p1 || p1.length<6) return alert('La contrase√±a debe tener al menos 6 caracteres');
    if (p1 !== p2) return alert('Las contrase√±as no coinciden');
    const { error } = await supabase.auth.updateUser({ password:p1 });
    if (error) return alert('No se pudo actualizar la contrase√±a');
    alert('Contrase√±a actualizada');
    pass.reset();
  });

  /* Preferencias de idioma deshabilitadas */
}
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const hideIfReady = (id, expected) => {
    const el = document.getElementById(id);
    if (el && !el.textContent.includes('Cargando')) {
      const change = el.parentElement.querySelector('.change');
      if (change) change.style.display = 'none';
    }
  };

  hideIfReady('balance-value');
  hideIfReady('purchases-value');
  hideIfReady('referrals-value');
  hideIfReady('tickets-value');
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const copyBtn = document.getElementById("copy-btn");
  const referralCode = document.getElementById("referral-code");

  if (copyBtn && referralCode) {
    copyBtn.addEventListener("click", async () => {
      const code = referralCode.textContent;

      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(code);
        } else {
          const textarea = document.createElement("textarea");
          textarea.value = code;
          textarea.style.position = "fixed";
          textarea.style.opacity = 0;
          document.body.appendChild(textarea);
          textarea.focus();
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);
        }

        copyBtn.textContent = "¬°Copiado!";
        setTimeout(() => copyBtn.textContent = "Copiar", 2000);
      } catch (err) {
        alert("No se pudo copiar el c√≥digo. Intenta manualmente.");
        console.error("Error al copiar:", err);
      }
    });
  }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const menuItems = document.querySelectorAll('.menu-item[data-target]');
  const sections = document.querySelectorAll('.section-content');

  menuItems.forEach(item => {
    item.addEventListener('click', () => {
      const target = item.getAttribute('data-target');
      sections.forEach(section => {
        section.style.display = section.id === 'section-' + target ? 'block' : 'none';
      });
      menuItems.forEach(i => i.classList.remove('active'));
      item.classList.add('active');
    });
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const menuItems = document.querySelectorAll(".menu-item[data-target]");
  const sections = document.querySelectorAll(".section-content");

  menuItems.forEach(item => {
    item.addEventListener("click", () => {
      const target = item.getAttribute("data-target");
      sections.forEach(section => {
        section.style.display = section.id === 'section-' + target ? 'block' : 'none';
      });
      menuItems.forEach(i => i.classList.remove("active"));
      item.classList.add("active");
    });
  });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const menuItems = document.querySelectorAll(".menu-item[data-target]");
  const mainDashboard = document.getElementById("main-dashboard");

  async function cargarDashboard() {
    console.log("[cargarDashboard] Ejecutando");

    document.getElementById('welcome-title').textContent = 'Cargando datos...';
    document.getElementById('referral-code').textContent = '---';
    document.getElementById('balance-value').textContent = '$---';
    document.getElementById('purchases-value').textContent = '--';
    document.getElementById('referrals-value').textContent = '--';
    document.getElementById('tickets-value').textContent = '--';
    document.getElementById('full-name').textContent = 'Cargando...';
    document.getElementById('user-email').textContent = 'Cargando...';
    document.getElementById('user-phone').textContent = 'Cargando...';
    document.getElementById('user-address').textContent = 'Cargando...';
    document.getElementById('purchases-body').innerHTML = '<tr><td colspan="5" style="text-align: center;">Cargando compras...</td></tr>';
    document.getElementById('referrals-body').innerHTML = '<tr><td colspan="5" style="text-align: center;">Cargando referidos...</td></tr>';

    const supabase = getSupabase();

    const { data: { user }, error } = await supabase.auth.getUser();
    if (error || !user) return;

    const { data: userData } = await supabase
      .from('users')
      .select('*, purchases(*), referrals(*)')
      .eq('id', user.id)
      .maybeSingle();

    if (!userData) return;

    document.getElementById('user-avatar').textContent = userData.full_name?.charAt(0).toUpperCase() || 'U';
    document.getElementById('welcome-title').textContent = 'Bienvenido, ' + (userData.full_name || userData.email);
    document.getElementById('referral-code').textContent = userData.referral_code || '---';
    document.getElementById('balance-value').textContent = '$' + (userData.balance?.toFixed(2) || '0.00');
    document.getElementById('purchases-value').textContent = userData.active_purchases || '0';
    document.getElementById('referrals-value').textContent = userData.referrals_count || '0';
    document.getElementById('tickets-value').textContent = userData.tickets_count || '0';
    document.getElementById('full-name').textContent = userData.full_name || 'No definido';
    document.getElementById('user-email').textContent = userData.email || 'No definido';
    document.getElementById('user-phone').textContent = userData.phone || 'No definido';
    document.getElementById('user-address').textContent = userData.address || 'No definido';

    const purchasesBody = document.getElementById('purchases-body');
    if (userData.purchases?.length > 0) {
      purchasesBody.innerHTML = '';
      userData.purchases.forEach(p => {
        const row = '<tr>' +
          '<td>' + p.product_name + '</td>' +
          '<td>' + new Date(p.created_at).toLocaleDateString() + '</td>' +
          '<td>$' + (p.value?.toFixed(2) || '0.00') + '</td>' +
          '<td><span class="status ' + p.status + '">' + p.status + '</span></td>' +
          '<td><button class="action-btn">Detalles</button></td>' +
          '</tr>';
        purchasesBody.innerHTML += row;
      });
    } else {
      purchasesBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No hay compras</td></tr>';
    }

    const referralsBody = document.getElementById('referrals-body');
    if (userData.referrals?.length > 0) {
      referralsBody.innerHTML = '';
      userData.referrals.forEach(r => {
        const row = '<tr>' +
          '<td>' + r.referred_email + '</td>' +
          '<td>' + new Date(r.created_at).toLocaleDateString() + '</td>' +
          '<td>' + (r.purchases_count || '0') + '</td>' +
          '<td><span class="status ' + (r.is_active ? 'active' : 'inactive') + '">' +
          (r.is_active ? 'Activo' : 'Inactivo') + '</span></td>' +
          '<td>$' + (r.commission?.toFixed(2) || '0.00') + '</td>' +
          '</tr>';
        referralsBody.innerHTML += row;
      });
    } else {
      referralsBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No hay referidos</td></tr>';
    }
  }

  menuItems.forEach(item => {
    item.addEventListener("click", () => {
      const target = item.getAttribute("data-target");
      menuItems.forEach(i => i.classList.remove("active"));
      item.classList.add("active");

      if (target === "dashboard") {
        mainDashboard.style.display = "block";
        cargarDashboard();
      } else if (target !== "logout") {
        mainDashboard.style.display = "none";
      }
    });
  });

  mainDashboard.style.display = "block";
  cargarDashboard();
});
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const menuCompras = document.querySelector('.menu-item[data-target="compras"]');
  const sectionCompras = document.getElementById("section-compras");
  const mainDashboard = document.getElementById("main-dashboard");
  const sectionConfig = document.getElementById('section-configuracion');
  const menuConfig = document.querySelector('.menu-item[data-target="configuracion"]');

  // Mis Compras
  if (menuCompras) {
    menuCompras.addEventListener("click", async () => {
      if (mainDashboard) mainDashboard.style.display = "none";
      if (sectionCompras) sectionCompras.style.display = "block";
      // Traer compras recientes del usuario desde Supabase
      try {
        const supabase = getSupabase();
        const { data: { user }, error: authError } = await supabase.auth.getUser();
        if (authError || !user) {
          window.location.href = '/login.html';
          return;
        }
        // Traer solo las 7 compras m√°s recientes del usuario
        const { data: purchases, error: purchaseError } = await supabase
          .from('purchases')
          .select('*')
          .eq('user_id', user.id)
          .order('created_at', { ascending: false })
          .limit(7);

        const tbody = document.getElementById('miscompras-body');
        if (purchaseError || !purchases) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No hay compras</td></tr>';
          return;
        }
        if (purchases.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No hay compras</td></tr>';
          return;
        }
        tbody.innerHTML = purchases.map(p => `
          <tr>
            <td>${p.product_name}</td>
            <td>${new Date(p.created_at).toLocaleDateString()}</td>
            <td>$${(p.value ?? 0).toFixed(2)}</td>
            <td><span class="status ${p.status}">${p.status}</span></td>
            <td><button class="action-btn" disabled>Hacer reclamo</button></td>
          </tr>
        `).join('');
      } catch (e) {
        const tbody = document.getElementById('miscompras-body');
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Error cargando compras</td></tr>';
      }
    });
  }

  // Configuraci√≥n
  if (menuConfig) {
    menuConfig.addEventListener("click", () => {
      if (mainDashboard) mainDashboard.style.display = "none";
      if (sectionCompras) sectionCompras.style.display = "none";
      if (sectionConfig) sectionConfig.style.display = "block";
      try { prefillConfigForms(window._userData || {}); } catch(e) {}
    });
  }
});
</script>




  </div>
</section>



<script>
(function(){
  function setSidebarWidthVar(){
    var sb = document.querySelector('.sidebar, .side-bar, nav.sidebar, aside.sidebar');
    var w = sb ? sb.offsetWidth : 0;
    document.documentElement.style.setProperty('--sidebar-w', (w || 240) + 'px');
  }
  setSidebarWidthVar();
  window.addEventListener('resize', setSidebarWidthVar);
})();
</script>


<!-- NUMINA: Modal global de detalle de producto -->
<div class="nm-overlay" id="nmOverlay" hidden inert>
  <div class="nm-modal" role="dialog" aria-modal="true" aria-labelledby="nmTitle">
    <header>
      <h3 id="nmTitle">Detalles del producto</h3>
      <button class="nm-close" id="nmClose" aria-label="Cerrar">‚úï</button>
    </header>
    <div class="nm-body">
      <div class="nm-imgbox"><img id="nmImg" alt="Producto"/></div>
      <div class="nm-info">
        <span id="nmSku" class="label" style="display:inline-block;padding:.15rem .5rem;border-radius:999px;background:#2a2a2a;color:#d7d7d7;font-size:12px;margin-bottom:12px"></span>
        <h4 id="nmName">‚Äî</h4>
        <p class="nm-desc" id="nmDesc">‚Äî</p>
        <div class="nm-price" id="nmPrice">‚Äî</div>
        <div class="nm-pitch" id="nmPitch" style="display:none"></div>
        <div class="nm-actions">
          <button class="nm-buy" id="nmBuy">Comprar</button>
        </div>
        <p class="nm-note">Env√≠os asegurados con seguimiento. Certificado incluido.</p>
      </div>
    </div>
  </div>
</div>




<script>
// NUMINA: Cat√°logo y modal a pantalla completa (sin aria-hidden warnings)
document.addEventListener('DOMContentLoaded', function(){
  const CATALOG = {
    "GOLD-100G": { sku:"GOLD-100G", name:"Lingote 100g Oro Fino 999.9", price:13500,
      img:"https://images.unsplash.com/photo-1623301762237-5b1056f3ce2d?q=80&w=1600&auto=format&fit=crop",
      pitch:"\ud83d\udcb0 <strong>Oro: Proteg\u00e9 tu dinero, asegur\u00e1 tu futuro</strong><br>Cuando todo sube y baja, el oro se mantiene firme. Es el activo refugio elegido por inversores de todo el mundo para proteger su patrimonio frente a la inflaci\u00f3n y la inestabilidad. El oro no depende de gobiernos ni bancos centrales: su valor es global, tangible y eterno. Comprarlo hoy es asegurarte un respaldo real que pod\u00e9s tener en tus manos y vender en cualquier momento. Invert\u00ed en oro y transform\u00e1 tu dinero en un activo que nunca pasa de moda y siempre vale.",
      desc:"Lingote de 100 g de oro 999.9 con n√∫mero de serie y certificado internacional. Alta liquidez y resguardo de valor." },
    "PLAT-100G": { sku:"PLAT-100G", name:"Lingote 100g Platino Fino 999.5", price:6500,
      img:"https://images.unsplash.com/photo-1617195737499-1d6bf14acaa7?q=80&w=1600&auto=format&fit=crop",
      pitch:"\ud83d\udc8e <strong>Platino: Exclusividad y potencial de crecimiento</strong><br>M\u00e1s escaso que el oro y con aplicaciones industriales cr\u00edticas (catalizadores, tecnolog\u00eda y joyer\u00eda), el platino combina lujo con oportunidad. Su rareza y demanda lo posicionan como un metal con fuerte potencial de revalorizaci\u00f3n a largo plazo. Asegur\u00e1 una parte de un recurso limitado, valioso y buscado en todo el mundo.",
      desc:"Lingote de 100 g de platino 999.5. Metal escaso, con potencial de revalorizaci√≥n a largo plazo." },
    "ROLEX-126610L": { sku:"ROLEX-126610L", name:"Rolex Submariner Date 126610LV", price:19600,
      img:"https://images.unsplash.com/photo-1524805444758-089113d48a6d?q=80&w=1600&auto=format&fit=crop",
      pitch:"\u231a <strong>Rolex Submariner \u201cStarbucks\u201d \u2013 S\u00faper Deportiva y Atemporal</strong><br>Con una caja Oystersteel de 41\u202fmm y bisel verde Cerachrom rotatorio unidireccional, este Submariner conserva ese dise\u00f1o ic\u00f3nico y elegante que lo define. Resistente al agua hasta 300 metros, cuenta con cristal de zafiro con lupa Cyclops y corona Triplock, combinando resistencia con claridad. Su calibre autom\u00e1tico 3235 de manufactura Rolex ofrece 70 horas de reserva de marcha, precisi\u00f3n certificada tipo cron\u00f3metro y protecci\u00f3n avanzada como resistencia a golpes y a campos magn\u00e9ticos. El brazalete Oyster con cierre Oysterlock y sistema Glidelock permite ajustes finos sin herramientas, adapt\u00e1ndose tanto a buceo como a uso diario. En conjunto, es el equilibrio perfecto entre tradici\u00f3n, ingenier\u00eda moderna y estilo deportivo de lujo.",
      desc:"Modelo 'Starbucks' con bisel cer√°mico verde y caja Oystersteel. Movimiento autom√°tico y hermeticidad profesional." },
    "NUMINA-BRACELET": { sku:"NUMINA-BRACELET", name:"Pulsera Numina ‚Äì Edici√≥n Limitada", price:35,
      img:"https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?q=80&w=1600&auto=format&fit=crop",
      pitch:"\ud83d\udc8e <strong>Pulsera Numina \u2013 Estilo que te acerca a un Rolex</strong><br>Fabricada en <em>acero inoxidable premium</em>, dise\u00f1ada para durar y lucir impecable. Con cada pulsera obten\u00e9s <strong>1 ticket</strong> para participar en el <strong>sorteo de un Rolex Submariner</strong>.<br><br>\ud83c\udf9f <u>Mec\u00e1nica del sorteo</u>:<br>\u2022 Pulsera = 1 ticket<br>\u2022 Rolex = 5 tickets<br>\u2022 Oro Fino = 2 tickets<br>\u2022 Platino Fino = 2 tickets<br><br>\ud83c\udf81 <u>Premios especiales</u>:<br>\u2022 El comprador n\u00famero 2.500 recibir\u00e1 una <strong>Pulsera de Platino</strong>.<br>\u2022 El comprador n\u00famero 5.000 recibir\u00e1 una <strong>Pulsera de Oro</strong>.<br>\u2022 Si un usuario compra 2.500 pulseras en total, se le enviar\u00e1 una <strong>Pulsera de Platino</strong>.<br>\u2022 Si un usuario compra 5.000 pulseras en total, se le enviar\u00e1 una <strong>Pulsera de Oro</strong>.<br>\u2022 Si un usuario compra 10.000 pulseras en total, se le enviar\u00e1 una <strong>Pulsera de Oro Full Ice con diamantes</strong>.<br><br>Cuando llegue el momento del sorteo, <strong>asegurate de tener tu lugar</strong>.",
      desc:"Pulsera exclusiva con dise√±o minimalista y materiales de alta calidad. Incluye bolsita de microfibra." }
  };

  const $ = (s, c=document) => c.querySelector(s);
  const overlay = $("#nmOverlay");
  const modal    = overlay ? overlay.querySelector(".nm-modal") : null;
  const closeBtn = $("#nmClose");
  const buyBtn   = $("#nmBuy");
  const imgEl    = $("#nmImg");
  const nameEl   = $("#nmName");
  const descEl   = $("#nmDesc");
  const priceEl  = $("#nmPrice");
  const skuEl    = $("#nmSku");

  function money(v){ return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(v); }

  let currentSku = null;
  let lastTrigger = null;

  function trapFocus(e){
    if (!overlay || overlay.hasAttribute('hidden')) return;
    const focusable = overlay.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (focusable.length === 0) return;
    const first = focusable[0];
    const last  = focusable[focusable.length - 1];
    if (e.key === 'Tab'){
      if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    }
  }

  function openSKU(sku, trigger){
    const p = CATALOG[sku];
    if(!p || !overlay) return;
    currentSku = sku;
    lastTrigger = trigger || document.activeElement;

    if (skuEl)  skuEl.textContent  = p.sku;
    if (nameEl) nameEl.textContent = p.name;
    if (descEl) descEl.textContent = p.desc;
    if (priceEl)priceEl.textContent= money(p.price);
    if (imgEl)  imgEl.src          = p.img;

    
    // Ensure price appears before description and pitch is placed after price
    try {
      if (descEl && priceEl && descEl.previousElementSibling !== priceEl) {
        descEl.parentNode.insertBefore(priceEl, descEl);
      }
      var pitchEl = document.getElementById('nmPitch');
      if (pitchEl) {
        if (p.pitch) {
          pitchEl.innerHTML = p.pitch;
          pitchEl.style.display = '';
          // make sure pitch is right after price
          if (priceEl.nextElementSibling !== pitchEl) {
            priceEl.parentNode.insertBefore(pitchEl, descEl);
          }
        } else {
          pitchEl.style.display = 'none';
          pitchEl.innerHTML = '';
        }
      }
    } catch(e) { console.warn('Pitch render skipped:', e); }
      if (!pitchEl) {
        if (p.pitch && descEl) {
          try {
            descEl.innerHTML = p.pitch + '<br><br>' + (p.desc || '');
          } catch(_) {
            descEl.textContent = (p.desc || '');
          }
        }
      }

overlay.classList.add("show");
    overlay.removeAttribute("hidden");
    overlay.removeAttribute("inert");
    if (modal) { modal.setAttribute("tabindex","-1"); modal.focus({preventScroll:true}); }
    if (closeBtn) closeBtn.focus({preventScroll:true});
    document.addEventListener('keydown', trapFocus);
  }

  function close(){
    if (!overlay) return;
    overlay.classList.remove("show");
    overlay.setAttribute("hidden","");
    overlay.setAttribute("inert","");
    document.removeEventListener('keydown', trapFocus);
    if (lastTrigger && typeof lastTrigger.focus === 'function') {
      setTimeout(()=> lastTrigger.focus(), 0);
    }
  }

  // Delegaci√≥n: abrir modal
  document.addEventListener("click", (e) => {
    const btn = e.target.closest('button[data-action=\"more\"][data-sku], button[data-product]');
    if (btn) {
      e.preventDefault();
      const sku = btn.getAttribute('data-sku') || btn.getAttribute('data-product');
      openSKU(sku, btn);
    }
  });

  // Bot√≥n comprar
  if (buyBtn) buyBtn.addEventListener('click', () => { if (currentSku) alert('Ir al checkout para ' + currentSku); });

  // Cerrar modal
  if (closeBtn) closeBtn.addEventListener('click', close);
  if (overlay) overlay.addEventListener('click', (e)=>{ if(e.target===overlay) close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
});
</script>

    


<!-- BEGIN: Numina checkout wiring (injected) -->
<script>
(function () {
  // ====== Config ======
  const PROJECT_URL = "https://xaeybhscsxpvtnqzpgwj.supabase.co"; // Your Supabase project URL
  const CREATE_INVOICE_FN = PROJECT_URL + "/functions/v1/create-invoice";

  // Basic helpers
  function findText(node, selectors) {
    for (const sel of selectors) {
      const el = document.querySelector(sel);
      if (el && el.textContent) return el.textContent.trim();
    }
    return "";
  }
  function getNumberFromText(txt) {
    // find first number (int/float) in text
    const m = (txt || "").replace(',', '.').match(/[-+]?\d*\.?\d+/);
    return m ? Number(m[0]) : NaN;
  }

  // Attempt to detect product info from DOM if not provided
  function detectProductInfo() {
    // name heuristics
    const name =
      (document.querySelector("[data-product-name]") || {}).textContent?.trim() ||
      findText(document, ["#productName", ".product-title", ".modal h3", ".modal h2", "h1, h2, h3"]);

    // sku heuristics (prefer explicit data-sku)
    const sku =
      (document.querySelector("[data-sku]") || {}).getAttribute?.("data-sku") ||
      (name ? "NUMINA-" + name.replace(/\s+/g, "-").toUpperCase() : "NUMINA-PROD");

    // price heuristics ‚Äì look for something near the CTA or price blocks
    let priceText =
      (document.querySelector("[data-price]") || {}).getAttribute?.("data-price") ||
      findText(document, [".price", ".product-price", ".modal .price", "#price", "[data-product-price]"]);

    let price = getNumberFromText(priceText);
    if (!isFinite(price) || price <= 0) {
      // fallback sensible default so we don't explode; UI will alert if remains invalid
      price = 30;
    }

    return { name: name || sku, sku, price_usd: price };
  }

  // Sweet alert helper (fallback to alert)
  function notify(msg) {
    if (window.Swal && Swal.fire) return Swal.fire({ text: msg, icon: "info" });
    alert(msg);
  }
  function notifyErr(msg) {
    if (window.Swal && Swal.fire) return Swal.fire({ text: msg, icon: "error" });
    alert(msg);
  }

  // Ensure global supabase client exists
  if (typeof window.supabase === "undefined") {
    console.warn("Supabase client not found. The checkout requires a logged-in session.");
  }

  async function ensureSession() {
    try {
      const { data } = await window.supabase.auth.getSession();
      return data?.session || null;
    } catch (e) {
      console.error(e);
      return null;
    }
  }

  async function startCheckout(opts = {}) {
    try {
      const sess = await ensureSession();
      if (!sess) {
        return notifyErr("Inicia sesi√≥n para continuar con la compra.");
      }
      const user = sess.user;

      // Product info
      const auto = detectProductInfo();
      const product = {
        name: opts.name || auto.name,
        sku: opts.sku || auto.sku,
        price_usd: Number(opts.price_usd ?? auto.price_usd) || 0,
      };
      if (!product.price_usd || product.price_usd <= 0) {
        return notifyErr("No pude detectar el precio del producto.");
      }

      // 1) Insert purchase (RLS should allow owner insert)
      const { data: inserted, error: e1 } = await window.supabase
        .from("purchases")
        .insert({
          user_id: user.id,
          product_name: product.name,
          value: product.price_usd,  // USD
          sku: product.sku,
          qty: 1,
          payment_provider: "nowpayments",
          status: "pending"
        })
        .select("id")
        .single();

      if (e1) {
        console.error(e1);
        return notifyErr("Error creando la orden: " + e1.message);
      }

      // 2) Call Edge Function to create invoice
      const res = await fetch(CREATE_INVOICE_FN, {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + sess.access_token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          purchase_id: inserted.id
          // Puedes enviar test_amount_usdt aqu√≠ para pruebas econ√≥micas:
          // , test_amount_usdt: 5
        })
      });

      let payload = {};
      try { payload = await res.json(); } catch {}

      if (!res.ok) {
        console.error("Edge error", payload);
        return notifyErr("No pude crear el pago: " + (payload?.nowpayments_error?.message || JSON.stringify(payload)));
      }

      if (payload.payment_url) {
        // 3) Redirect to NOWPayments
        window.location.href = payload.payment_url;
      } else {
        notify("Orden creada, pero no recib√≠ URL de pago. Detalle: " + JSON.stringify(payload));
      }
    } catch (err) {
      console.error(err);
      notifyErr("Ocurri√≥ un error iniciando el checkout.");
    }
  }

  // Expose globally in case other scripts want to call it
  window.startCheckout = startCheckout;

  // Wire default CTA if present
  const buyBtn = document.querySelector("#nmBuy, [data-action='buy'], .buy-cta");
  if (buyBtn) {
    buyBtn.addEventListener("click", function (ev) {
      ev.preventDefault();
      // If the button carries data attributes, use them
      const opts = {
        name: this.getAttribute("data-name") || undefined,
        sku: this.getAttribute("data-sku") || undefined,
        price_usd: this.getAttribute("data-price-usd") ? Number(this.getAttribute("data-price-usd")) : undefined
      };
      startCheckout(opts);
    });
  }
})();
</script>
<!-- END: Numina checkout wiring (injected) -->
</body></html>
